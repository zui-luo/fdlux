<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Bç«¯éƒ¨é—¨æ ‘æœç´¢åŸå‹</title>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        :root {
            --primary-color: #1677ff;
            --hover-bg: #f5f5f5;
            --border-color: #d9d9d9;
            --text-color: #333;
            --highlight-color: #ff4d4f;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; padding: 40px; background: #f0f2f5; }
        
        /* å®¹å™¨æ ·å¼ */
        .tree-container {
            width: 320px;
            background: #fff;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #eee;
            overflow-x: auto; /* æ¨ªå‘æ»šåŠ¨ */
        }

        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            position: relative;
            margin-bottom: 12px;
        }
        .search-input {
            width: 100%;
            padding: 8px 12px 8px 30px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            outline: none;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        .search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(22, 119, 255, 0.2); }
        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 12px;
        }

        /* æ ‘ç»“æ„æ ·å¼ */
        .tree-root { 
            list-style: none; 
            padding-left: 0; 
            margin: 0; 
            width: max-content; /* ç¡®ä¿å†…å®¹å¯ä»¥è¶…å‡ºå®¹å™¨ */
            min-width: 100%;
        }
        .tree-node { 
            list-style: none; 
            white-space: nowrap; /* é˜²æ­¢èŠ‚ç‚¹æ¢è¡Œ */
        }
        .node-content {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            color: var(--text-color);
            white-space: nowrap; /* é˜²æ­¢å†…å®¹æ¢è¡Œ */
            flex-shrink: 0; /* é˜²æ­¢æ”¶ç¼© */
        }
        .node-content:hover { background-color: var(--hover-bg); }
        .node-content.selected { background-color: #e6f7ff; color: var(--primary-color); }
        
        /* æ›´å¤šæŒ‰é’®æ ·å¼ */
        .more-btn {
            margin-left: auto;
            padding: 2px 8px;
            font-size: 12px;
            color: var(--primary-color);
            background: transparent;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            flex-shrink: 0;
            white-space: nowrap;
        }
        .node-content:hover .more-btn {
            opacity: 1;
        }
        .more-btn:hover {
            background-color: var(--primary-color);
            color: #fff;
        }
        
        /* å±•å¼€ç®­å¤´ */
        .arrow {
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 4px;
            cursor: pointer;
            transform: rotate(-90deg);
            transition: transform 0.2s;
            color: #999;
            font-size: 10px;
        }
        .arrow.expanded { transform: rotate(0deg); }
        .arrow.hidden { visibility: hidden; } /* å¶å­èŠ‚ç‚¹æ— ç®­å¤´ */

        /* å­åˆ—è¡¨ç¼©è¿› */
        .node-children {
            padding-left: 24px;
            display: none; /* é»˜è®¤æŠ˜å  */
            overflow: visible; /* å…è®¸å†…å®¹è¶…å‡º */
            white-space: nowrap; /* é˜²æ­¢å­èŠ‚ç‚¹æ¢è¡Œ */
        }
        .node-children.visible { display: block; }

        /* å›¾æ ‡ä¸æ–‡å­— */
        .folder-icon { margin-right: 6px; color: #faad14; flex-shrink: 0; }
        .file-icon { margin-right: 6px; color: #8c8c8c; flex-shrink: 0; }
        .node-text { white-space: nowrap; flex-shrink: 0; } /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
        .highlight { color: var(--primary-color); font-weight: bold; background: rgba(255, 255, 0, 0.2); }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state { text-align: center; color: #999; padding: 20px; display: none; font-size: 13px; }
    </style>
</head>
<body>

<div class="tree-container">
    <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢éƒ¨é—¨æˆ–äººå‘˜...">
    </div>
    
    <ul class="tree-root" id="treeRoot">
        <!-- æ ‘èŠ‚ç‚¹å°†é€šè¿‡JSç”Ÿæˆ -->
    </ul>
    <div class="empty-state" id="emptyState">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>
</div>

<script>
    // 1. æ¨¡æ‹Ÿ Bç«¯ ç»„ç»‡æ¶æ„æ•°æ® - 10å±‚æ·±åº¦
    // éƒ¨é—¨åç§°åº“ï¼ˆ8ä¸ªå­—å·¦å³ï¼‰
    const deptNames = [
        'é›†å›¢æ€»éƒ¨ç®¡ç†ä¸­å¿ƒ', 'æˆ˜ç•¥è§„åˆ’å‘å±•éƒ¨é—¨', 'äººåŠ›èµ„æºç®¡ç†éƒ¨é—¨', 'è´¢åŠ¡å®¡è®¡æ ¸ç®—ä¸­å¿ƒ',
        'æŠ€æœ¯ç ”å‘åˆ›æ–°ä¸­å¿ƒ', 'äº§å“è¿è¥æ¨å¹¿éƒ¨é—¨', 'å¸‚åœºè¥é”€æ‹“å±•ä¸­å¿ƒ', 'å®¢æˆ·æœåŠ¡æ”¯æŒéƒ¨é—¨',
        'è´¨é‡ç®¡æ§ç›‘ç£ä¸­å¿ƒ', 'æ³•åŠ¡åˆè§„å®¡æŸ¥éƒ¨é—¨', 'è¡Œæ”¿åå‹¤ä¿éšœä¸­å¿ƒ', 'ä¿¡æ¯å®‰å…¨ç®¡ç†ä¸­å¿ƒ',
        'ä¾›åº”é“¾ç®¡ç†è¿è¥ä¸­å¿ƒ', 'å“ç‰Œå½¢è±¡å®£ä¼ æ¨å¹¿éƒ¨', 'æ•°æ®åˆ†æå†³ç­–æ”¯æŒä¸­å¿ƒ', 'é¡¹ç›®åè°ƒæ¨è¿›ç®¡ç†éƒ¨é—¨',
        'é£é™©æ§åˆ¶è¯„ä¼°ç›‘æµ‹ä¸­å¿ƒ', 'æŠ•èµ„å¹¶è´­æˆ˜ç•¥è§„åˆ’éƒ¨', 'å›½é™…ä¸šåŠ¡æ‹“å±•å‘å±•ä¸­å¿ƒ', 'æ•°å­—åŒ–è½¬å‹æ¨è¿›éƒ¨é—¨'
    ];
    
    // é€’å½’ç”Ÿæˆæ ‘èŠ‚ç‚¹
    function createNode(id, level, maxLevel, nameIndex) {
        const node = {
            id: id,
            title: deptNames[nameIndex % deptNames.length],
            children: []
        };
        
        if (level < maxLevel) {
            // æ¯å±‚ç”Ÿæˆ2ä¸ªå­èŠ‚ç‚¹
            for (let i = 1; i <= 2; i++) {
                const childId = id * 10 + i;
                const childNameIndex = (nameIndex * 2 + i) % deptNames.length;
                node.children.push(createNode(childId, level + 1, maxLevel, childNameIndex));
            }
        }
        
        return node;
    }
    
    const treeData = [
        createNode(1, 1, 10, 0),
        createNode(2, 1, 10, 5)
    ];

    const treeRoot = document.getElementById('treeRoot');
    const emptyState = document.getElementById('emptyState');
    let allNodeElements = []; // å­˜å‚¨æ‰€æœ‰DOMèŠ‚ç‚¹çš„å¼•ç”¨ä»¥ä¾¿æ“ä½œ

    // 2. æ¸²æŸ“æ ‘å‡½æ•° (é€’å½’)
    function renderTree(data, parentElement) {
        data.forEach(item => {
            const li = document.createElement('li');
            li.className = 'tree-node';
            
            const hasChildren = item.children && item.children.length > 0;
            
            // æ„å»ºèŠ‚ç‚¹å†…å®¹
            const contentDiv = document.createElement('div');
            contentDiv.className = 'node-content';
            contentDiv.dataset.id = item.id;
            contentDiv.dataset.title = item.title; // å­˜å‚¨åŸå§‹æ ‡é¢˜ç”¨äºæœç´¢åŒ¹é…
            
            // ç®­å¤´
            const arrow = document.createElement('span');
            arrow.className = `arrow ${hasChildren ? '' : 'hidden'}`;
            arrow.innerHTML = 'â–¼';
            
            // å›¾æ ‡
            const icon = document.createElement('span');
            icon.className = hasChildren ? 'folder-icon' : 'file-icon';
            icon.innerHTML = hasChildren ? 'ğŸ“' : 'ğŸ‘¤'; // ç®€å•Emojiä»£æ›¿å›¾æ ‡

            // æ–‡æœ¬
            const textSpan = document.createElement('span');
            textSpan.className = 'node-text';
            textSpan.innerText = item.title;

            // æ›´å¤šæŒ‰é’®
            const moreBtn = document.createElement('button');
            moreBtn.className = 'more-btn';
            moreBtn.innerText = 'æ›´å¤š';
            moreBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘å±•å¼€/æŠ˜å 
                // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæ“ä½œï¼Œæ¯”å¦‚æ˜¾ç¤ºèœå•ã€å¼¹çª—ç­‰
                console.log('ç‚¹å‡»æ›´å¤šæŒ‰é’®:', item.title);
                alert(`ç‚¹å‡»äº† "${item.title}" çš„æ›´å¤šæŒ‰é’®`);
            });

            contentDiv.append(arrow, icon, textSpan, moreBtn);
            li.appendChild(contentDiv);

            // ç‚¹å‡»å±•å¼€/æŠ˜å é€»è¾‘
            contentDiv.addEventListener('click', (e) => {
                // ä»…ç‚¹å‡»å†…å®¹åŒºåŸŸé€‰ä¸­
                document.querySelectorAll('.node-content').forEach(el => el.classList.remove('selected'));
                contentDiv.classList.add('selected');
                
                // ç‚¹å‡»ç®­å¤´æˆ–è€…åŒå‡»å†…å®¹è§¦å‘å±•å¼€
                if(hasChildren && (e.target === arrow || !e.target.classList.contains('arrow'))) {
                   toggleNode(li);
                }
            });

            // é€’å½’å­èŠ‚ç‚¹
            if (hasChildren) {
                const childUl = document.createElement('ul');
                childUl.className = 'node-children';
                renderTree(item.children, childUl);
                li.appendChild(childUl);
            }

            parentElement.appendChild(li);
            allNodeElements.push({ 
                dom: li, 
                text: item.title, 
                contentDiv: contentDiv,
                textSpan: textSpan,
                hasChildren: hasChildren,
                childrenUl: li.querySelector('.node-children'),
                arrow: arrow
            });
        });
    }

    function toggleNode(liNode, forceState = null) {
        const childrenUl = liNode.querySelector('.node-children');
        const arrow = liNode.querySelector('.arrow');
        if (!childrenUl) return;

        const isVisible = childrenUl.classList.contains('visible');
        const shouldShow = forceState !== null ? forceState : !isVisible;

        if (shouldShow) {
            childrenUl.classList.add('visible');
            arrow.classList.add('expanded');
        } else {
            childrenUl.classList.remove('visible');
            arrow.classList.remove('expanded');
        }
    }

    // 3. æœç´¢é€»è¾‘æ ¸å¿ƒ (Key Algorithm)
    function filterTree(keyword) {
        let hasResult = false;
        
        // é€’å½’æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åº”è¯¥æ˜¾ç¤º
        // è¿”å›å€¼: boolean (æ˜¯å¦åŒ…å«åŒ¹é…é¡¹æˆ–å­èŠ‚ç‚¹åŒ…å«åŒ¹é…é¡¹)
        function checkNodeVisibility(domData) {
            const nodeText = domData.text.toLowerCase();
            const searchKey = keyword.toLowerCase();
            const isSelfMatch = nodeText.includes(searchKey);
            
            let isChildMatch = false;

            // å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œé€’å½’æ£€æŸ¥å­èŠ‚ç‚¹
            if (domData.hasChildren) {
                // æ‰¾åˆ°è¯¥DOMä¸‹çš„æ‰€æœ‰ç›´æ¥å­çº§li
                const childLis = Array.from(domData.childrenUl.children);
                childLis.forEach(childLi => {
                    // åœ¨allNodeElementsä¸­æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡ (æ­¤å¤„ä¸ºäº†Demoç®€å•ï¼Œé€šè¿‡éå†æŸ¥æ‰¾ï¼Œå®é™…é¡¹ç›®å¯ç”¨Mapä¼˜åŒ–)
                    const childData = allNodeElements.find(n => n.dom === childLi);
                    if (childData) {
                       const childVisible = checkNodeVisibility(childData);
                       if (childVisible) isChildMatch = true;
                    }
                });
            }

            // å†³ç­–æ˜¾ç¤ºé€»è¾‘
            if (keyword === "") {
                // æ¸…ç©ºæœç´¢æ—¶ï¼šæ˜¾ç¤ºæ‰€æœ‰ï¼Œç§»é™¤é«˜äº®ï¼ŒæŠ˜å 
                domData.dom.style.display = 'block';
                domData.textSpan.innerHTML = domData.text;
                if(domData.hasChildren) toggleNode(domData.dom, false); // é»˜è®¤æŠ˜å 
                return true;
            }

            if (isSelfMatch || isChildMatch) {
                domData.dom.style.display = 'block';
                hasResult = true;
                
                // 1. é«˜äº®å¤„ç†
                if (isSelfMatch) {
                    const regex = new RegExp(`(${keyword})`, 'gi');
                    domData.textSpan.innerHTML = domData.text.replace(regex, '<span class="highlight">$1</span>');
                } else {
                    domData.textSpan.innerHTML = domData.text;
                }

                // 2. è‡ªåŠ¨å±•å¼€ï¼šå¦‚æœæ˜¯å­èŠ‚ç‚¹åŒ¹é…ï¼Œçˆ¶äº²å¿…é¡»å±•å¼€
                if (isChildMatch && domData.hasChildren) {
                    toggleNode(domData.dom, true);
                }
                
                return true;
            } else {
                domData.dom.style.display = 'none';
                return false;
            }
        }

        // æ‰§è¡Œéå†
        // åªæœ‰é¡¶çº§èŠ‚ç‚¹éœ€è¦è§¦å‘é€’å½’å…¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹æ‰€æœ‰å­˜å…¥çš„èŠ‚ç‚¹åšå¤„ç†ï¼Œ
        // ä½†ä¸ºäº†ä¿è¯å±‚çº§é€»è¾‘ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªéœ€å¯¹é¡¶çº§DOMè¿›è¡Œéå†ï¼Œæˆ–è€…åˆ©ç”¨checkNodeVisibilityå†…éƒ¨é€»è¾‘ã€‚
        // åœ¨Flatæ•°æ®ç»“æ„ä¸‹å¾ˆéš¾åŠï¼Œæ‰€ä»¥æˆ‘ä»¬é‡æ–°éå†é¡¶å±‚liã€‚
        const rootLis = Array.from(document.getElementById('treeRoot').children);
        rootLis.forEach(rootLi => {
             const rootData = allNodeElements.find(n => n.dom === rootLi);
             checkNodeVisibility(rootData);
        });

        // ç©ºçŠ¶æ€æ§åˆ¶
        emptyState.style.display = (hasResult || keyword === "") ? 'none' : 'block';
    }

    // åˆå§‹åŒ–
    renderTree(treeData, treeRoot);

    // ç»‘å®šæœç´¢äº‹ä»¶
    document.getElementById('searchInput').addEventListener('input', (e) => {
        filterTree(e.target.value.trim());
    });

</script>
</body>
</html>